<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FilmangStream Vimeo</title>

<style>
:root{
  --red:#e50914; --bg:#0b0b0b; --card:#161616; --text:#fff; --muted:#aaa;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text);}
header{position:sticky;top:0;z-index:10;background:#000c;padding:12px;display:flex;gap:10px;align-items:center;}
header h1{color:var(--red);margin:0;font-size:20px;}
input,select{background:#222;color:#fff;border:none;border-radius:20px;padding:10px 14px;}
.section{padding:14px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:14px;}
.card{background:var(--card);border-radius:14px;overflow:hidden;cursor:pointer;transition:.2s;}
.card:hover{transform:scale(1.04);}
.card img{width:100%;display:block;}
.card p{margin:8px;font-size:13px;text-align:center;}
.badge{font-size:11px;color:var(--muted);}
#player{position:fixed;inset:0;background:#000;display:none;flex-direction:column;z-index:9999;}
#playerTop{padding:10px;display:flex;gap:8px;align-items:center;}
button{background:#222;color:#fff;border:none;padding:8px 12px;border-radius:10px;}
iframe{flex:1;width:100%;border:none;}
</style>
</head>

<body>

<header>
<h1>üé¨ Filmang</h1>
<input id="search" placeholder="Rechercher un film ou s√©rie ou anime">
<select id="lang">
  <option value="fr">FR</option>
  <option value="en">EN</option>
</select>
</header>

<div class="section">
<h3>üî• Tendances</h3>
<div id="trending" class="grid"></div>
</div>

<div class="section">
<h3>üîç R√©sultats</h3>
<div id="results" class="grid"></div>
</div>

<div class="section">
<h3>üç• Vimeo Animations & Anime CC</h3>
<div id="vimeo" class="grid"></div>
</div>

<!-- PLAYER -->
<div id="player">
  <div id="playerTop">
    <button onclick="closePlayer()">‚¨Ö Retour</button>
  </div>
  <iframe id="iframe" allow="autoplay; fullscreen"></iframe>
</div>

<script>
// üîë Cl√© TMDB
const TMDB_KEY="1073e4d36ef71f912da093a5eb38f091";
const API="https://api.themoviedb.org/3";
const IMG="https://image.tmdb.org/t/p/w500";

let current={};

const get=u=>fetch(u).then(r=>r.json());

// Utilitaire pour cr√©er une card
function card(container,item,titleType){
  if(!item.poster_path && !item.thumbnail) return;
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`
    <img src="${item.poster_path? IMG+item.poster_path : item.thumbnail}">
    <p>${item.title||item.name}<br><span class="badge">${titleType}</span></p>
  `;
  d.onclick=()=>openContent(item,titleType);
  container.appendChild(d);
}

/* üîπ TMDB Tendances */
async function loadTrending(){
  const r = await get(`${API}/trending/all/week?api_key=${TMDB_KEY}&language=${lang.value}`);
  trending.innerHTML="";
  r.results.forEach(x=>card(trending,x,"TMDB"));
}

/* üîπ Recherche */
search.onkeydown=async e=>{
  if(e.key!=="Enter") return;
  results.innerHTML="";
  const q=search.value.trim();
  if(!q) return;

  const r=await get(`${API}/search/multi?api_key=${TMDB_KEY}&query=${encodeURIComponent(q)}&language=${lang.value}`);
  r.results.forEach(x=>card(results,x,"TMDB"));
};

/* üîπ Vimeo CC Animations / Anime */
const vimeoData=[
  {title:"Big Buck Bunny",thumbnail:"https://peach.blender.org/wp-content/uploads/title_anouncement.jpg?x11217",url:"https://player.vimeo.com/video/17466681"},
  {title:"Elephants Dream",thumbnail:"https://orange.blender.org/wp-content/themes/od/images/ed_header.jpg",url:"https://player.vimeo.com/video/24281094"},
  {title:"Sintel",thumbnail:"https://durian.blender.org/wp-content/uploads/2010/05/sintel_poster.jpg",url:"https://player.vimeo.com/video/69565484"},
  {title:"Tears of Steel",thumbnail:"https://mango.blender.org/wp-content/uploads/2012/06/ToS_poster.jpg",url:"https://player.vimeo.com/video/74289686"}
];
function loadVimeo(){vimeo.innerHTML=""; vimeoData.forEach(f=>card(vimeo,f,"Vimeo"));}

/* üîπ OUVERTURE PLAYER */
function openContent(item,type){
  current=item;
  if(type==="TMDB"){
    get(`${API}/${item.media_type}/${item.id}/videos?api_key=${TMDB_KEY}`)
    .then(r=>r.json())
    .then(v=>{
      const yt=v.results.find(x=>x.site==="YouTube");
      if(yt) openPlayer(`https://www.youtube.com/embed/${yt.key}`,"youtube");
      else alert("Pas de vid√©o officielle");
    });
  } else {
    openPlayer(item.url,"iframe");
  }
}

function openPlayer(url,mode){
  player.style.display="flex";
  iframe.src=url;
}

function closePlayer(){player.style.display="none"; iframe.src="";}

/* LANGUE */
lang.onchange=()=>{loadTrending();};

/* INIT */
loadTrending();
loadVimeo();
</script>

</body>
</html>
