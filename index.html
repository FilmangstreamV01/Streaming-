<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmAngStream - Live</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #0a0a0b; color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .header { padding: 40px 0; border-bottom: 2px solid #00adef; margin-bottom: 30px; }
        h1 { color: #00adef; text-transform: uppercase; letter-spacing: 2px; }
        .btn { background: #00adef; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn:hover { background: #0080af; }
        #vimeo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; max-width: 1200px; margin: 30px auto; }
        .video-card { background: #161618; border-radius: 12px; overflow: hidden; border: 1px solid #333; }
        .player-container { position: relative; padding-top: 56.25%; }
        .player-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .error-msg { background: #411; color: #f88; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 600px; display: none; }
    </style>
</head>
<body>

    <div class="header">
        <h1>FilmAngStream</h1>
        <p>Ma Bibliothèque Vidéo Privée</p>
    </div>

    <div id="auth-section">
        <button class="btn" onclick="login()">Se connecter avec Google</button>
    </div>

    <div id="error-box" class="error-msg"></div>

    <div id="vimeo-grid">
        </div>

    <script>
        // 1. CONFIGURATION FIREBASE (Vérifiée avec tes identifiants)
        const firebaseConfig = {
            apiKey: "AIzaSyA3J4K7ZMGYoWMTxBVlN5-Lsgb5orolLi0",
            authDomain: "filmangstream.firebaseapp.com",
            projectId: "filmangstream",
            storageBucket: "filmangstream.appspot.com",
            messagingSenderId: "887863323394",
            appId: "1:887863323394:web:6e6328905f32a74794e775"
        };
        firebase.initializeApp(firebaseConfig);

        // 2. TON TOKEN VIMEO
        const VIM_TK = "ZtDImh52MQIIWDo4IiLtVVcKu7SIiLpqIYEwKvtferpOZy5ltN5uW6ayed+syId/6sJctfRScopKdkJt9pi/JSFSgP87yfie3C2pcEY0/msCihm3xCVuh2z8XcqOLNal";

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            // Utilisation de Redirect pour éviter les erreurs de Popup sur mobile
            firebase.auth().signInWithRedirect(provider);
        }

        async function fetchVideos() {
            const grid = document.getElementById('vimeo-grid');
            const errorBox = document.getElementById('error-box');
            try {
                const response = await fetch('https://api.vimeo.com/me/videos', {
                    headers: { 'Authorization': 'Bearer ' + VIM_TK.trim() }
                });
                const data = await response.json();

                if (data.error) throw new Error(data.developer_message || "Token Invalide");

                if (data.data) {
                    grid.innerHTML = data.data.map(v => `
                        <div class="video-card">
                            <div class="player-container">
                                <iframe src="https://player.vimeo.com/video/${v.uri.split('/')[2]}" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <div style="padding:15px; font-weight:bold;">${v.name}</div>
                        </div>
                    `).join('');
                }
            } catch (err) {
                errorBox.style.display = "block";
                errorBox.innerText = "Erreur Vimeo : " + err.message;
            }
        }

        // Gestion du statut de connexion
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-section').innerHTML = `<h3>Bienvenue ${user.displayName}</h3><p>Accès autorisé à vos 6 clés API.</p>`;
            }
            fetchVideos();
        });
    </script>
</body>
</html>
