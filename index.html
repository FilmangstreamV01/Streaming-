<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FilmangStream</title>

<style>
:root{--red:#e50914;--bg:#141414;--card:#1f1f1f}
body{margin:0;background:var(--bg);color:#fff;font-family:Arial}
header{background:var(--red);padding:15px;text-align:center;font-size:22px;font-weight:bold}
.search{padding:10px}
.search input{width:100%;padding:12px;border-radius:6px;border:none}
.section{padding:10px}
h2{margin:10px 0}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px}
.card{background:var(--card);border-radius:8px;overflow:hidden;cursor:pointer}
.card img{width:100%}
.card p{font-size:13px;padding:6px;text-align:center}

#playerBox{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:#000;display:none;flex-direction:column;z-index:999
}
#playerHeader{background:var(--red);padding:12px;font-weight:bold}
#playerFrame{width:100%;height:100%;border:none}

.list{padding:10px}
.list button{
  width:100%;padding:10px;margin:6px 0;
  background:#222;color:#fff;border:none;border-radius:6px
}
</style>
</head>

<body>

<header>üé¨ FilmangStream</header>

<div class="search">
  <input id="search" placeholder="Rechercher film, s√©rie, anime...">
</div>

<div class="section">
<h2>üé¨ Films</h2>
<div class="grid" id="movies"></div>
</div>

<div class="section">
<h2>üì∫ S√©ries</h2>
<div class="grid" id="series"></div>
</div>

<div class="section">
<h2>üç• Anime</h2>
<div class="grid" id="anime"></div>
</div>

<div id="playerBox">
  <div id="playerHeader" onclick="closePlayer()">‚¨Ö Retour</div>
  <iframe id="playerFrame" allowfullscreen></iframe>
</div>

<script>
const KEY="1073e4d36ef71f912da093a5eb38f091";
const IMG="https://image.tmdb.org/t/p/w500";

async function api(url){return (await fetch(url)).json();}

function draw(id,list,type){
  const box=document.getElementById(id);
  box.innerHTML="";
  list.forEach(i=>{
    if(!i.poster_path) return;
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`<img src="${IMG+i.poster_path}"><p>${i.title||i.name}</p>`;
    d.onclick=()=>open(type,i.id);
    box.appendChild(d);
  });
}

function playMovie(id){
  openPlayer(`https://letsembed.cc/embed/movie/?id=${id}`);
}

function openPlayer(src){
  document.getElementById("playerFrame").src=src;
  document.getElementById("playerBox").style.display="flex";
}

function closePlayer(){
  document.getElementById("playerFrame").src="";
  document.getElementById("playerBox").style.display="none";
}

async function open(type,id){
  if(type==="movie"){ playMovie(id); return; }

  const data=await api(`https://api.themoviedb.org/3/tv/${id}?api_key=${KEY}&language=fr`);
  let html=`<div class="list"><h3>${data.name}</h3>`;
  data.seasons.forEach(s=>{
    if(s.season_number>0)
      html+=`<button onclick="loadEpisodes(${id},${s.season_number})">
        Saison ${s.season_number} (${s.episode_count})
      </button>`;
  });
  html+="</div>";
  showList(html);
}

async function loadEpisodes(id,season){
  const data=await api(`https://api.themoviedb.org/3/tv/${id}/season/${season}?api_key=${KEY}&language=fr`);
  let html=`<div class="list"><h3>Saison ${season}</h3>`;
  data.episodes.forEach(e=>{
    html+=`<button onclick="openPlayer('https://letsembed.cc/embed/tv/?id=${id}/${season}/${e.episode_number}')">
      √âpisode ${e.episode_number} ‚Äì ${e.name}
    </button>`;
  });
  html+="</div>";
  showList(html);
}

function showList(content){
  document.getElementById("playerFrame").src="";
  document.getElementById("playerHeader").innerHTML=content;
  document.getElementById("playerBox").style.display="flex";
}

document.getElementById("search").addEventListener("keyup",async e=>{
  const q=e.target.value;
  if(q.length<2){init();return;}
  const r=await api(`https://api.themoviedb.org/3/search/multi?api_key=${KEY}&query=${q}&language=fr`);
  draw("movies",r.results.filter(x=>x.media_type==="movie"),"movie");
  draw("series",r.results.filter(x=>x.media_type==="tv"),"tv");
  draw("anime",r.results.filter(x=>x.media_type==="tv"),"anime");
});

async function init(){
  draw("movies",(await api(`https://api.themoviedb.org/3/movie/popular?api_key=${KEY}&language=fr`)).results,"movie");
  draw("series",(await api(`https://api.themoviedb.org/3/tv/popular?api_key=${KEY}&language=fr`)).results,"tv");
  draw("anime",(await api(`https://api.themoviedb.org/3/discover/tv?api_key=${KEY}&with_genres=16&language=fr`)).results,"anime");
}
init();
</script>

</body>
</html>
