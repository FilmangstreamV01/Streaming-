<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamTube - Cin√©ma Mondial</title>
    <style>
        :root {
            --primary: #e50914;
            --dark: #141414;
            --gray: #333;
            --text: #fff;
        }

        body {
            background-color: var(--dark);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 50px;
        }

        /* Navigation */
        header {
            display: flex;
            flex-direction: column;
            padding: 15px 4%;
            background: #000;
            position: sticky;
            top: 0;
            z-index: 50;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .logo { 
            color: var(--primary); 
            font-size: 2rem; 
            font-weight: bold; 
            text-transform: uppercase; 
            letter-spacing: 2px;
        }

        /* Menu de navigation d√©filant */
        nav {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 5px;
            gap: 10px;
            scrollbar-width: none; /* Firefox */
        }
        nav::-webkit-scrollbar { display: none; } /* Chrome/Safari */

        nav button {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #ddd;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 0.9rem;
            border-radius: 20px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        nav button:hover, nav button.active { 
            background: var(--text); 
            color: var(--dark); 
            font-weight: bold;
        }

        /* Contenu */
        #content-area { padding: 20px 4%; min-height: 80vh; }
        
        .section-title { 
            margin-top: 10px; 
            margin-bottom: 20px;
            font-size: 1.8rem; 
            border-left: 5px solid var(--primary);
            padding-left: 15px;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .movie-card {
            background: #1f1f1f;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .movie-card:hover { 
            transform: scale(1.05); 
            z-index: 2; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }
        
        .movie-card img { 
            width: 100%; 
            height: 270px; 
            object-fit: cover; 
            opacity: 0.9;
        }
        
        .movie-info { padding: 12px; }
        .movie-title { 
            font-size: 0.95rem; 
            font-weight: bold; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            margin-bottom: 5px;
        }
        .movie-meta { font-size: 0.8rem; color: #aaa; }

        /* Modal Lecteur */
        #videoModal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow-y: auto;
            padding-top: 20px;
        }

        .player-wrapper {
            width: 90%;
            max-width: 1000px;
            aspect-ratio: 16/9;
            background: #000;
            box-shadow: 0 0 30px rgba(229, 9, 20, 0.3);
            border-radius: 8px;
            overflow: hidden;
        }
        
        iframe { width: 100%; height: 100%; border: none; }

        .controls {
            width: 90%;
            max-width: 1000px;
            margin-top: 20px;
            background: #1a1a1a;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 50px;
        }

        .controls h2 { margin-top: 0; color: var(--primary); }

        .lang-section {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .lang-buttons { 
            margin-top: 15px; 
            display: flex; 
            flex-wrap: wrap; 
            gap: 10px; 
        }
        
        .btn-lang {
            background: transparent;
            border: 1px solid #555;
            color: white;
            padding: 8px 20px;
            cursor: pointer;
            border-radius: 50px;
            transition: 0.2s;
            font-size: 0.9rem;
        }
        .btn-lang:hover { 
            background: var(--text); 
            color: var(--dark); 
            border-color: var(--text); 
        }

        /* Messages d'√©tat */
        #statusMessage {
            margin-top: 15px;
            font-weight: bold;
            padding: 10px;
            border-radius: 4px;
            display: none; /* Cach√© par d√©faut */
        }
        .error { background: rgba(255, 68, 68, 0.2); color: #ff4444; border: 1px solid #ff4444; }
        .success { background: rgba(0, 200, 81, 0.2); color: #00c851; border: 1px solid #00c851; }
        .loading { background: rgba(51, 181, 229, 0.2); color: #33b5e5; border: 1px solid #33b5e5; }

        .close-modal {
            position: absolute; top: 15px; right: 25px;
            font-size: 40px; cursor: pointer; color: white;
            z-index: 1100;
            transition: 0.3s;
        }
        .close-modal:hover { color: var(--primary); transform: rotate(90deg); }

        /* Loader */
        .loader {
            border: 4px solid rgba(255,255,255,0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 50px auto;
            display: none;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <header>
        <div class="header-top">
            <div class="logo">StreamTube</div>
        </div>
        <nav id="navMenu">
            <button onclick="fetchMovies('Action', this)" class="active">Action</button>
            <button onclick="fetchMovies('Drama', this)">Drame</button>
            <button onclick="fetchMovies('Hollywood', this)">Hollywood</button>
            <button onclick="fetchMovies('Nollywood', this)">Nollywood</button>
            <button onclick="fetchMovies('Comedy', this)">Com√©die</button>
            <button onclick="fetchMovies('Horror', this)">Horreur</button>
            <button onclick="fetchMovies('Romance', this)">Romance</button>
            <button onclick="fetchMovies('Sci-Fi', this)">Science-Fiction</button>
            <button onclick="fetchMovies('Thriller', this)">Thriller</button>
            <button onclick="fetchMovies('Kung Fu', this)">Arts Martiaux</button>
            <button onclick="fetchMovies('Anime', this)">Animation</button>
        </nav>
    </header>

    <div id="content-area">
        </div>
    <div class="loader" id="mainLoader"></div>

    <div id="videoModal">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        
        <div class="player-wrapper">
            <div id="playerFrame"></div>
        </div>

        <div class="controls">
            <h2 id="mTitle">Titre du film</h2>
            <p id="mDesc" style="color:#ccc; font-size:0.9rem; line-height: 1.4;">Description du film...</p>
            
            <div class="lang-section">
                <h3>üåç Langues disponibles</h3>
                <p style="font-size: 0.8rem; color: #aaa; margin-bottom: 10px;">Cliquez pour rechercher ce film dans une autre langue :</p>
                
                <div class="lang-buttons">
                    <button class="btn-lang" onclick="tryChangeLanguage('fr', 'Fran√ßais')">üá´üá∑ Fran√ßais (VF)</button>
                    <button class="btn-lang" onclick="tryChangeLanguage('en', 'Anglais')">üá∫üá∏ Anglais (VO)</button>
                    <button class="btn-lang" onclick="tryChangeLanguage('es', 'Espagnol')">üá™üá∏ Espagnol</button>
                    <button class="btn-lang" onclick="tryChangeLanguage('de', 'Allemand')">üá©üá™ Allemand</button>
                    <button class="btn-lang" onclick="tryChangeLanguage('hi', 'Hindi')">üáÆüá≥ Hindi</button>
                    <button class="btn-lang" onclick="tryChangeLanguage('ar', 'Arabe')">üá∏üá¶ Arabe</button>
                </div>
                
                <div id="statusMessage"></div>
            </div>
        </div>
    </div>

    <script>
        // ---------------------------------------------------------
        // CONFIGURATION ET CL√â API
        // ---------------------------------------------------------
        const API_KEY = 'AIzaSyD4Fd78deAlUd8H8kU4X3WfYVlW0-FmWmc'; 
        const BASE_URL = 'https://www.googleapis.com/youtube/v3/search';
        
        let currentMovieOriginalTitle = "";

        // Initialisation au chargement
        window.onload = () => fetchMovies('Action', document.querySelector('nav button'));

        // ---------------------------------------------------------
        // LOGIQUE PRINCIPALE : CHARGEMENT DES FILMS
        // ---------------------------------------------------------
        async function fetchMovies(genre, btnElement) {
            // Gestion de l'interface (bouton actif)
            if(btnElement) {
                document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
            }

            const container = document.getElementById('content-area');
            const loader = document.getElementById('mainLoader');
            
            container.innerHTML = ''; // Vider la grille
            container.innerHTML = `<h2 class="section-title">Films : ${genre}</h2><div class="movie-grid" id="gridRef"></div>`;
            const grid = document.getElementById('gridRef');
            
            loader.style.display = 'block'; // Afficher le chargement

            // Construction de la requ√™te intelligente
            // On ajoute des mots cl√©s pour filtrer les faux films
            let queryKeywords = `full movie ${genre}`;
            if(genre === 'Nollywood') queryKeywords = `nollywood movies latest full movie`;
            if(genre === 'Hollywood') queryKeywords = `hollywood full movie english`;

            const url = `${BASE_URL}?part=snippet&maxResults=25&q=${encodeURIComponent(queryKeywords)}&type=video&videoDuration=long&videoDefinition=high&key=${API_KEY}`;

            try {
                const res = await fetch(url);
                const data = await res.json();
                
                loader.style.display = 'none'; // Cacher le chargement

                if(data.error) {
                    container.innerHTML += `<div style="color:red; padding:20px;">Erreur API: ${data.error.message} <br> (V√©rifiez si le quota est d√©pass√©)</div>`;
                    return;
                }

                if(!data.items || data.items.length === 0) {
                    container.innerHTML += `<div style="padding:20px;">Aucun film trouv√© pour cette cat√©gorie.</div>`;
                    return;
                }

                displayGrid(grid, data.items);

            } catch (e) {
                console.error(e);
                loader.style.display = 'none';
                container.innerHTML += `<div style="color:red; padding:20px;">Erreur de connexion.</div>`;
            }
        }

        // Affichage des cartes de films
        function displayGrid(gridContainer, items) {
            items.forEach(item => {
                const vidTitle = item.snippet.title;
                const vidId = item.id.videoId;
                const thumb = item.snippet.thumbnails.high ? item.snippet.thumbnails.high.url : item.snippet.thumbnails.medium.url;
                const desc = item.snippet.description;
                const date = new Date(item.snippet.publishedAt).getFullYear();

                // Nettoyage des cha√Ænes pour √©viter les bugs JS dans le onclick
                const safeTitle = vidTitle.replace(/'/g, "&apos;").replace(/"/g, "&quot;");
                const safeDesc = desc.replace(/'/g, "&apos;").replace(/"/g, "&quot;").replace(/\n/g, " ");

                // Filtrage basique : On n'affiche pas si pas d'image
                if(thumb) {
                    const card = document.createElement('div');
                    card.className = 'movie-card';
                    card.onclick = () => openPlayer(vidId, safeTitle, safeDesc);
                    
                    card.innerHTML = `
                        <img src="${thumb}" alt="Cover">
                        <div class="movie-info">
                            <div class="movie-title">${vidTitle}</div>
                            <div class="movie-meta">${date} ‚Ä¢ YouTube</div>
                        </div>
                    `;
                    gridContainer.appendChild(card);
                }
            });
        }

        // ---------------------------------------------------------
        // LOGIQUE DU LECTEUR ET DES LANGUES
        // ---------------------------------------------------------
        function openPlayer(id, title, desc) {
            const modal = document.getElementById('videoModal');
            document.getElementById('mTitle').innerHTML = title; // innerHTML pour d√©coder les caract√®res sp√©ciaux
            document.getElementById('mDesc').innerHTML = desc;
            
            // Reset de l'√©tat
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.style.display = 'none';
            statusDiv.className = '';

            // Nettoyage du titre pour la recherche future (retire les mots parasites)
            // Ex: "Action Movie 2024 Full HD" -> devient le titre plus propre
            currentMovieOriginalTitle = title
                .replace(/full movie|film complet|official|hd|4k|1080p|english|french|francais|movie/gi, "")
                .replace(/[()]/g, "") // Enl√®ve les parenth√®ses
                .trim();

            if(currentMovieOriginalTitle.length < 3) currentMovieOriginalTitle = title; // S√©curit√© si on a trop nettoy√©

            loadIframe(id);
            modal.style.display = 'flex';
        }

        function loadIframe(id) {
            const frame = document.getElementById('playerFrame');
            // autoplay=1 lance la vid√©o, rel=0 √©vite les pubs concurrentes √† la fin
            frame.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&rel=0&modestbranding=1" allowfullscreen allow="autoplay"></iframe>`;
        }

        function closeModal() {
            document.getElementById('videoModal').style.display = 'none';
            document.getElementById('playerFrame').innerHTML = ''; // Stop le son
        }

        // Fonction de changement de langue avec v√©rification
        async function tryChangeLanguage(langCode, langName) {
            const statusDiv = document.getElementById('statusMessage');
            
            // Affichage √©tat chargement
            statusDiv.style.display = 'block';
            statusDiv.className = 'loading';
            statusDiv.innerText = `‚è≥ Recherche de "${currentMovieOriginalTitle}" en version ${langName}...`;

            // Cr√©ation de la requ√™te sp√©cifique
            let suffix = "";
            switch(langCode) {
                case 'fr': suffix = "complet en fran√ßais"; break;
                case 'es': suffix = "pelicula completa espa√±ol"; break;
                case 'de': suffix = "ganzer film deutsch"; break;
                case 'it': suffix = "film completo italiano"; break;
                case 'ar': suffix = "film kamil arabic"; break;
                case 'hi': suffix = "full movie hindi dubbed"; break;
                default: suffix = `full movie ${langName}`;
            }

            // On cherche le titre + le mot cl√© de langue
            const query = `${currentMovieOriginalTitle} ${suffix}`;
            const url = `${BASE_URL}?part=snippet&maxResults=1&q=${encodeURIComponent(query)}&type=video&videoDuration=long&key=${API_KEY}`;

            try {
                const res = await fetch(url);
                const data = await res.json();

                if (!data.items || data.items.length === 0) {
                    // √âchec
                    statusDiv.className = 'error';
                    statusDiv.innerText = `‚ùå D√©sol√©, aucune version ${langName} trouv√©e pour ce titre sp√©cifique sur YouTube.`;
                } else {
                    // Succ√®s
                    const vid = data.items[0];
                    statusDiv.className = 'success';
                    statusDiv.innerHTML = `‚úÖ Trouv√© ! Chargement de : <i>${vid.snippet.title}</i>`;
                    
                    // Petite pause pour laisser l'utilisateur lire le message de succ√®s avant de lancer
                    setTimeout(() => {
                        loadIframe(vid.id.videoId);
                    }, 1000);
                }

            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.innerText = "Erreur technique lors de la recherche.";
            }
        }

        // Fermer le modal si on clique en dehors du contenu
        window.onclick = function(event) {
            const modal = document.getElementById('videoModal');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
