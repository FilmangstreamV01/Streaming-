<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FilmangStream+</title>

<style>
:root{
  --red:#e50914;
  --bg:#0b0b0b;
  --card:#161616;
  --text:#fff;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui;
}
header{
  padding:14px;
  background:linear-gradient(90deg,#b00610,#e50914);
  font-size:22px;
  text-align:center;
  font-weight:700;
}
.section{padding:14px}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
  gap:12px;
}
.card{
  background:var(--card);
  border-radius:14px;
  overflow:hidden;
  cursor:pointer;
  transition:.2s;
}
.card:hover{transform:scale(1.05)}
.card img{width:100%;display:block}
.card p{
  margin:6px;
  font-size:13px;
  text-align:center;
}
#playerUI{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  z-index:9999;
}
#topbar{
  display:flex;
  gap:8px;
  padding:10px;
  align-items:center;
  background:linear-gradient(#000,#000a);
}
select,button,input{
  background:#222;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 10px;
}
#playerBox{
  flex:1;
  position:relative;
}
#playerBox iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
}
.search{
  padding:10px;
}
</style>
</head>

<body>

<header>üé¨ FilmangStream+</header>

<div class="search">
  <input id="search" placeholder="üîç Rechercher un film, une s√©rie‚Ä¶" style="width:100%">
</div>

<div class="section">
<h3>üî• Films populaires</h3>
<div id="movies" class="grid"></div>
</div>

<div class="section">
<h3>üì∫ S√©ries populaires</h3>
<div id="series" class="grid"></div>
</div>

<div class="section">
<h3>üç• Anime</h3>
<div id="anime" class="grid"></div>
</div>

<!-- PLAYER -->
<div id="playerUI">
  <div id="topbar">
    <button onclick="closePlayer()">‚¨Ö</button>
    <select id="season" style="display:none"></select>
    <select id="episode" style="display:none"></select>
    <button onclick="addFav()">‚ù§Ô∏è</button>
  </div>
  <div id="playerBox"></div>
</div>

<script>
const TMDB="https://api.themoviedb.org/3";
const KEY="1073e4d36ef71f912da093a5eb38f091";
const IMG="https://image.tmdb.org/t/p/w500";

let current={};

async function get(u){return(await fetch(u)).json();}

function card(container,item,type){
  if(!item.poster_path)return;
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`
    <img src="${IMG+item.poster_path}">
    <p>${item.title||item.name}</p>
  `;
  d.onclick=()=>openContent(type,item.id);
  container.appendChild(d);
}

async function loadHome(){
  (await get(`${TMDB}/movie/popular?api_key=${KEY}&language=fr`))
    .results.forEach(x=>card(movies,x,"movie"));

  (await get(`${TMDB}/tv/popular?api_key=${KEY}&language=fr`))
    .results.forEach(x=>card(series,x,"tv"));

  (await get(`${TMDB}/discover/tv?api_key=${KEY}&with_genres=16&language=fr`))
    .results.forEach(x=>card(anime,x,"tv"));
}

async function openContent(type,id){
  playerUI.style.display="flex";
  playerBox.innerHTML="";
  season.style.display="none";
  episode.style.display="none";

  current={type,id};

  if(type==="movie"){
    playMovie();
  }else{
    const tv=await get(`${TMDB}/tv/${id}?api_key=${KEY}&language=fr`);
    season.innerHTML="";
    tv.seasons.forEach(s=>{
      if(s.episode_count>0){
        season.innerHTML+=`
          <option value="${s.season_number}">
            ${s.season_number===0?"Sp√©ciaux":"Saison "+s.season_number}
          </option>`;
      }
    });
    season.style.display="block";
  }
}

season.onchange=async()=>{
  current.season=season.value;
  const s=await get(`${TMDB}/tv/${current.id}/season/${current.season}?api_key=${KEY}&language=fr`);
  episode.innerHTML="";
  s.episodes.forEach(e=>{
    episode.innerHTML+=`
      <option value="${e.episode_number}">
        √âpisode ${e.episode_number}
      </option>`;
  });
  episode.style.display="block";
};

episode.onchange=()=>{
  current.episode=episode.value;
  playEpisode();
};

function playMovie(){
  playerBox.innerHTML=`
    <iframe src="https://player.vidplus.to/embed/movie/${current.id}"
      allow="autoplay; fullscreen" allowfullscreen></iframe>`;
}

function playEpisode(){
  playerBox.innerHTML=`
    <iframe src="https://player.vidplus.to/embed/tv/${current.id}/${current.season}/${current.episode}"
      allow="autoplay; fullscreen" allowfullscreen></iframe>`;
}

function closePlayer(){
  playerUI.style.display="none";
  playerBox.innerHTML="";
}

function addFav(){
  let fav=JSON.parse(localStorage.getItem("fav")||"[]");
  if(!fav.find(f=>f.id===current.id)){
    fav.push(current);
    localStorage.setItem("fav",JSON.stringify(fav));
    alert("Ajout√© aux favoris ‚ù§Ô∏è");
  }
}

search.oninput=async()=>{
  const q=search.value.trim();
  if(q.length<3)return;
  movies.innerHTML=series.innerHTML=anime.innerHTML="";
  const r=await get(`${TMDB}/search/multi?api_key=${KEY}&query=${q}&language=fr`);
  r.results.forEach(x=>{
    if(x.media_type==="movie")card(movies,x,"movie");
    if(x.media_type==="tv")card(series,x,"tv");
  });
};

loadHome();
</script>
</body>
</html>
