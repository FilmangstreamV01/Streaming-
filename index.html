<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FilmangStream NextGen</title>
<style>
body {margin:0; background:#0b0b0b; color:#fff; font-family:system-ui;}
header {padding:14px; font-size:22px; text-align:center; background:#e50914;}
.section {padding:14px;}
.grid {display:grid; grid-template-columns:repeat(auto-fill,minmax(140px,1fr)); gap:12px;}
.card {background:#161616; border-radius:14px; overflow:hidden; transition:.2s; cursor:pointer;}
.card:active {transform:scale(.97);}
.card img {width:100%;}
.card p {margin:6px; font-size:13px; text-align:center;}
#playerUI {position:fixed; inset:0; background:#000; display:none; flex-direction:column; z-index:9999;}
#topbar {display:flex; gap:8px; padding:10px; background:linear-gradient(#000,#000a); align-items:center;}
select,button{background:#222;color:#fff;border:none;border-radius:10px;padding:8px 10px;font-size:14px;}
#playerBox{flex:1; position:relative;}
#playerBox iframe{position:absolute; inset:0; width:100%; height:100%; border:none;}
.badge{font-size:11px;color:#aaa;}
</style>
</head>
<body>

<header>üé¨ FilmangStream NextGen</header>

<div class="section">
<h3>üé¨ Films</h3>
<div id="movies" class="grid"></div>
</div>

<div class="section">
<h3>üì∫ S√©ries</h3>
<div id="series" class="grid"></div>
</div>

<div class="section">
<h3>üç• Anime</h3>
<div id="anime" class="grid"></div>
</div>

<!-- PLAYER -->
<div id="playerUI">
  <div id="topbar">
    <button onclick="closePlayer()">‚¨Ö</button>
    <select id="season" style="display:none"></select>
    <select id="episode" style="display:none"></select>
    <select id="lang"></select>
    <button onclick="switchSource()">üîÅ Source</button>
    <span class="badge" id="sourceLabel"></span>
  </div>
  <div id="playerBox"></div>
</div>

<script>
const API = "https://api.themoviedb.org/3";
const KEY = "1073e4d36ef71f912da093a5eb38f091";
const IMG = "https://image.tmdb.org/t/p/w500";

let current = {};
let sourceIndex = 0;
let langIndex = 0;

// Multi-sources (NextGen APIs)
const SOURCES = {
  movie: [
    id => `https://player.embed-api.stream/?id=${id}&type=movie`,
    id => `https://letsembed.cc/embed/movie/?id=${id}`,
    id => `https://moviesapi.pro/movie/${id}`,
    id => `https://player.vidplus.to/embed/movie/${id}`
  ],
  tv: [
    (id,s,e) => `https://player.embed-api.stream/?id=${id}&s=${s}&e=${e}`,
    (id,s,e) => `https://letsembed.cc/embed/tv/?id=${id}/${s}/${e}`,
    (id,s,e) => `https://moviesapi.pro/tv/${id}/${s}/${e}`,
    (id,s,e) => `https://player.vidplus.to/embed/tv/${id}/${s}/${e}`
  ]
};

// Langues audio possibles (si disponibles)
const LANGS = ["original","french","english","spanish","german"]; // tu peux ajouter d'autres

async function get(url){ return (await fetch(url)).json(); }

function card(container,item,type){
  if(!item.poster_path) return;
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML = `<img src="${IMG+item.poster_path}"><p>${item.title||item.name}</p>`;
  d.onclick = () => openContent(type,item.id);
  container.appendChild(d);
}

async function loadHome(){
  (await get(`${API}/movie/popular?api_key=${KEY}&language=fr`)).results.forEach(x=>card(movies,x,"movie"));
  (await get(`${API}/tv/popular?api_key=${KEY}&language=fr`)).results.forEach(x=>card(series,x,"tv"));
  (await get(`${API}/discover/tv?api_key=${KEY}&with_genres=16&language=fr`)).results.forEach(x=>card(anime,x,"tv"));
}

async function openContent(type,id){
  playerUI.style.display="flex";
  playerBox.innerHTML="";
  season.style.display="none";
  episode.style.display="none";
  lang.style.display="inline-block";
  langIndex = 0;
  sourceIndex = 0;
  current = {type,id,lang:LANGS[0]};

  // Remplir menu langues
  lang.innerHTML = "";
  LANGS.forEach(l => {lang.innerHTML += `<option value="${l}">${l.toUpperCase()}</option>`});

  if(type==="movie"){ play(); updateSourceLabel(); }
  else {
    const tv = await get(`${API}/tv/${id}?api_key=${KEY}&language=fr`);
    season.innerHTML = "<option>Saison</option>";
    tv.seasons.forEach(s=>{
      if(s.season_number>0)
        season.innerHTML += `<option value="${s.season_number}">Saison ${s.season_number}</option>`;
    });
    season.style.display="block";
  }
}

// Changement de saison
season.onchange = async () => {
  current.season = season.value;
  const e = await get(`${API}/tv/${current.id}/season/${current.season}?api_key=${KEY}&language=fr`);
  episode.innerHTML="<option>√âpisode</option>";
  e.episodes.forEach(ep=>{
    episode.innerHTML += `<option value="${ep.episode_number}">√âpisode ${ep.episode_number}</option>`;
  });
  episode.style.display="block";
}

// Changement d'√©pisode
episode.onchange = () => {
  current.episode = episode.value;
  play(); updateSourceLabel();
}

// Changement de langue
lang.onchange = () => {
  current.lang = lang.value;
  play(); updateSourceLabel();
}

// Lecture
function play(){
  const iframe = document.createElement("iframe");
  iframe.allow = "autoplay; fullscreen";
  iframe.allowFullscreen = true;

  let src;
  if(current.type==="movie") src = SOURCES.movie[sourceIndex](current.id) + `&lang=${current.lang}`;
  else src = SOURCES.tv[sourceIndex](current.id,current.season,current.episode) + `&lang=${current.lang}`;

  iframe.src = src;
  playerBox.innerHTML = "";
  playerBox.appendChild(iframe);
  updateSourceLabel();
}

// Changer de source
function switchSource(){
  sourceIndex++;
  if(current.type==="movie" && sourceIndex>=SOURCES.movie.length) sourceIndex=0;
  if(current.type==="tv" && sourceIndex>=SOURCES.tv.length) sourceIndex=0;
  play();
}

function updateSourceLabel(){
  const sources = current.type==="movie" ? SOURCES.movie : SOURCES.tv;
  sourceLabel.textContent = `Source: ${sourceIndex+1}/${sources.length} | Lang: ${current.lang.toUpperCase()}`;
}

function closePlayer(){
  playerUI.style.display="none";
  playerBox.innerHTML="";
}

loadHome();
</script>

</body>
</html>
