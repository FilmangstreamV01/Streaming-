<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FilmangStream</title>

<style>
body{margin:0;background:#111;color:#fff;font-family:Arial}
header{background:#e50914;padding:15px;font-size:22px;text-align:center}
input,select,button{padding:10px;border:none;border-radius:6px}
.search{padding:10px}
.section{padding:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px}
.card{background:#222;border-radius:8px;overflow:hidden;cursor:pointer}
.card img{width:100%}
.card p{text-align:center;font-size:13px;padding:5px}

#player{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:none;flex-direction:column;z-index:999}
#playerTop{background:#e50914;padding:10px;display:flex;justify-content:space-between}
iframe{flex:1;border:none}

.list button{width:100%;margin:5px 0;background:#222;color:#fff}
</style>
</head>

<body>

<header>üé¨ FilmangStream</header>

<div class="search">
<input id="search" placeholder="Rechercher film, s√©rie, anime...">
</div>

<div class="section">
<h2>üé¨ Films</h2>
<div class="grid" id="movies"></div>
</div>

<div class="section">
<h2>üì∫ S√©ries</h2>
<div class="grid" id="series"></div>
</div>

<div class="section">
<h2>üç• Anime</h2>
<div class="grid" id="anime"></div>
</div>

<div id="player">
<div id="playerTop">
<span onclick="closePlayer()">‚¨Ö Retour</span>
<select id="lang" onchange="reloadLang()">
<option value="">Auto</option>
<option value="vf">VF</option>
<option value="vostfr">VOSTFR</option>
</select>
</div>
<iframe id="frame" allowfullscreen></iframe>
</div>

<script>
const API="https://api.themoviedb.org/3";
const KEY="1073e4d36ef71f912da093a5eb38f091";
const IMG="https://image.tmdb.org/t/p/w500";
let currentSrc="";

async function get(url){return (await fetch(url)).json();}

function card(container,item,type){
  if(!item.poster_path) return;
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`<img src="${IMG+item.poster_path}"><p>${item.title||item.name}</p>`;
  d.onclick=()=>open(type,item.id);
  container.appendChild(d);
}

async function init(){
  const m=await get(`${API}/movie/popular?api_key=${KEY}&language=fr`);
  m.results.forEach(x=>card(movies,x,"movie"));

  const s=await get(`${API}/tv/popular?api_key=${KEY}&language=fr`);
  s.results.forEach(x=>card(series,x,"tv"));

  const a=await get(`${API}/discover/tv?api_key=${KEY}&with_genres=16&language=fr`);
  a.results.forEach(x=>card(anime,x,"tv"));
}

function play(src){
  currentSrc=src;
  frame.src=src;
  player.style.display="flex";
}

function reloadLang(){
  if(!currentSrc) return;
  let l=lang.value ? `?lang=${lang.value}` : "";
  frame.src=currentSrc+l;
}

function closePlayer(){
  frame.src="";
  player.style.display="none";
}

async function open(type,id){
  if(type==="movie"){
    play(`https://letsembed.cc/embed/movie/${id}`);
    return;
  }

  const tv=await get(`${API}/tv/${id}?api_key=${KEY}&language=fr`);
  let html=`<div class="list"><h3>${tv.name}</h3>
  <p>Saisons totales : ${tv.number_of_seasons}</p>`;

  tv.seasons.forEach(s=>{
    if(s.season_number>0){
      html+=`<button onclick="episodes(${id},${s.season_number})">
      Saison ${s.season_number} (${s.episode_count} √©pisodes)
      </button>`;
    }
  });
  html+=`</div>`;
  player.style.display="flex";
  frame.src="about:blank";
  playerTop.innerHTML=html;
}

async function episodes(id,season){
  const e=await get(`${API}/tv/${id}/season/${season}?api_key=${KEY}&language=fr`);
  let html=`<div class="list"><h3>Saison ${season}</h3>`;
  e.episodes.forEach(ep=>{
    html+=`<button onclick="play('https://letsembed.cc/embed/tv/${id}/${season}/${ep.episode_number}')">
    √âpisode ${ep.episode_number} ‚Äì ${ep.name}
    </button>`;
  });
  html+=`</div>`;
  playerTop.innerHTML=html;
}

search.onkeyup=async ()=>{
  const q=search.value;
  if(q.length<2){movies.innerHTML="";series.innerHTML="";anime.innerHTML="";init();return;}
  const r=await get(`${API}/search/multi?api_key=${KEY}&query=${q}&language=fr`);
  movies.innerHTML="";series.innerHTML="";anime.innerHTML="";
  r.results.forEach(x=>{
    if(x.media_type==="movie") card(movies,x,"movie");
    if(x.media_type==="tv") card(series,x,"tv");
  });
}

init();
</script>
</body>
</html>
