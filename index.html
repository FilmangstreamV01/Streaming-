<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmAngStream - Live GitHub</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <style>
        body { background-color: #0a0a0b; color: white; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .header { padding: 30px 0; border-bottom: 2px solid #00adef; margin-bottom: 20px; }
        h1 { color: #00adef; margin: 0; }
        .btn { background: #00adef; color: white; border: none; padding: 12px 25px; border-radius: 25px; font-weight: bold; cursor: pointer; }
        #vimeo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .video-card { background: #161618; border-radius: 12px; overflow: hidden; border: 1px solid #333; padding-bottom: 10px; }
        .player { position: relative; padding-top: 56.25%; }
        .player iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .error-msg { background: #411; color: #f88; padding: 15px; border-radius: 8px; margin: 20px; display: none; }
    </style>
</head>
<body>

    <div class="header">
        <h1>FILMANGSTREAM</h1>
        <p>Ma Bibliothèque Vidéo Privée</p>
    </div>

    <div id="auth-section">
        <button class="btn" onclick="login()">Se connecter avec Google</button>
    </div>

    <div id="error-box" class="error-msg"></div>

    <div id="vimeo-grid">
        </div>

    <script>
        // 1. TA CONFIGURATION FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyA3J4K7ZMGYoWMTxBVlN5-Lsgb5orolLi0",
            authDomain: "filmangstream.firebaseapp.com",
            projectId: "filmangstream",
            storageBucket: "filmangstream.appspot.com",
            messagingSenderId: "887863323394",
            appId: "1:887863323394:web:6e6328905f32a74794e775"
        };
        firebase.initializeApp(firebaseConfig);

        // 2. TON TOKEN VIMEO
        const VIM_TK = "ZtDImh52MQIIWDo4IiLtVVcKu7SIiLpqIYEwKvtferpOZy5ltN5uW6ayed+syId/6sJctfRScopKdkJt9pi/JSFSgP87yfie3C2pcEY0/msCihm3xCVuh2z8XcqOLNal";

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            // Sur mobile/GitHub, signInWithRedirect est plus fiable que Popup
            firebase.auth().signInWithRedirect(provider);
        }

        async function chargerVideos() {
            const grid = document.getElementById('vimeo-grid');
            const errorBox = document.getElementById('error-box');

            try {
                const response = await fetch('https://api.vimeo.com/me/videos', {
                    method: 'GET',
                    headers: { 'Authorization': 'Bearer ' + VIM_TK }
                });

                const data = await response.json();

                if (data.data && data.data.length > 0) {
                    grid.innerHTML = data.data.map(v => {
                        const id = v.uri.split('/')[2];
                        return `
                            <div class="video-card">
                                <div class="player">
                                    <iframe src="https://player.vimeo.com/video/${id}" frameborder="0" allowfullscreen></iframe>
                                </div>
                                <p>${v.name}</p>
                            </div>`;
                    }).join('');
                } else if (data.error) {
                    errorBox.style.display = "block";
                    errorBox.innerText = "Vimeo dit : " + data.error;
                }
            } catch (err) {
                console.error(err);
            }
        }

        // Vérifier si on revient d'une connexion Google
        firebase.auth().getRedirectResult().then((result) => {
            if (result.user) {
                document.getElementById('auth-section').innerHTML = "Connecté : " + result.user.displayName;
            }
        });

        // Charger les vidéos immédiatement
        chargerVideos();
    </script>
</body>
</html>
