<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FilmangStream</title>

<style>
:root{
  --red:#e50914;
  --bg:#0b0b0b;
  --card:#161616;
  --text:#fff;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}
header{
  padding:16px;
  text-align:center;
  font-size:24px;
  font-weight:800;
  background:var(--red);
}
.section{padding:16px}
.section h2{margin:0 0 12px}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:14px;
}

.card{
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
  transition:.25s;
}
.card:hover{transform:scale(1.05)}
.card img{width:100%;display:block}
.card p{
  margin:6px;
  font-size:14px;
  text-align:center;
}

/* PLAYER */
#playerUI{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  z-index:9999;
}
#topbar{
  display:flex;
  gap:8px;
  padding:10px;
  background:linear-gradient(#000,#000a);
}
button,select{
  background:#222;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:6px 10px;
  font-size:14px;
}
button.primary{background:var(--red)}
#playerBox{
  flex:1;
  position:relative;
}
#playerBox iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none;
}
</style>
</head>

<body>

<header>üé¨ FilmangStream</header>

<div class="section">
  <h2>üé¨ Films</h2>
  <div id="movies" class="grid"></div>
</div>

<div class="section">
  <h2>üì∫ S√©ries</h2>
  <div id="series" class="grid"></div>
</div>

<div class="section">
  <h2>üç• Anime</h2>
  <div id="anime" class="grid"></div>
</div>

<!-- PLAYER -->
<div id="playerUI">
  <div id="topbar">
    <button onclick="closePlayer()">‚¨Ö</button>

    <select id="season" style="display:none"></select>
    <select id="episode" style="display:none"></select>

    <select id="lang">
      <option value="fr">VF</option>
      <option value="en">VO</option>
    </select>

    <button class="primary" onclick="reloadPlayer()">üîÑ</button>
  </div>
  <div id="playerBox"></div>
</div>

<script>
/* ================= CONFIG ================= */
const TMDB_KEY = "1073e4d36ef71f912da093a5eb38f091";
const TMDB = "https://api.themoviedb.org/3";
const IMG = "https://image.tmdb.org/t/p/w500";

/* VidAPI embeds */
const VIDAPI = {
  movie: id => `https://vidapi.xyz/embed/movie/${id}`,
  tv: (id,s,e) => `https://vidapi.xyz/embed/tv/${id}/${s}/${e}`
};

let current = {};
const movies = document.getElementById("movies");
const series = document.getElementById("series");
const anime  = document.getElementById("anime");

const playerUI = document.getElementById("playerUI");
const playerBox = document.getElementById("playerBox");
const seasonSel = document.getElementById("season");
const episodeSel = document.getElementById("episode");

/* ================= UTILS ================= */
const get = u => fetch(u).then(r=>r.json());

function makeCard(container,item,type){
  if(!item.poster_path) return;
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`
    <img src="${IMG+item.poster_path}">
    <p>${item.title||item.name}</p>
  `;
  d.onclick=()=>openContent(type,item.id);
  container.appendChild(d);
}

/* ================= LOAD HOME ================= */
async function loadHome(){
  (await get(`${TMDB}/movie/popular?api_key=${TMDB_KEY}&language=fr`))
    .results.forEach(x=>makeCard(movies,x,"movie"));

  (await get(`${TMDB}/tv/popular?api_key=${TMDB_KEY}&language=fr`))
    .results.forEach(x=>makeCard(series,x,"tv"));

  (await get(`${TMDB}/discover/tv?api_key=${TMDB_KEY}&with_genres=16&language=fr`))
    .results.forEach(x=>makeCard(anime,x,"tv"));
}

/* ================= PLAYER ================= */
async function openContent(type,id){
  playerUI.style.display="flex";
  playerBox.innerHTML="";
  seasonSel.style.display="none";
  episodeSel.style.display="none";

  current={type,id};

  if(type==="movie"){
    playMovie();
  }else{
    const tv=await get(`${TMDB}/tv/${id}?api_key=${TMDB_KEY}&language=fr`);
    seasonSel.innerHTML="<option>Saison</option>";
    tv.seasons.forEach(s=>{
      if(s.season_number>0)
        seasonSel.innerHTML+=`<option value="${s.season_number}">Saison ${s.season_number}</option>`;
    });
    seasonSel.style.display="block";
  }
}

seasonSel.onchange=async()=>{
  current.season=seasonSel.value;
  const s=await get(`${TMDB}/tv/${current.id}/season/${current.season}?api_key=${TMDB_KEY}&language=fr`);
  episodeSel.innerHTML="<option>√âpisode</option>";
  s.episodes.forEach(e=>{
    episodeSel.innerHTML+=`<option value="${e.episode_number}">√âpisode ${e.episode_number}</option>`;
  });
  episodeSel.style.display="block";
};

episodeSel.onchange=()=>{
  current.episode=episodeSel.value;
  playEpisode();
};

function playMovie(){
  const iframe=document.createElement("iframe");
  iframe.src=VIDAPI.movie(current.id);
  iframe.allow="autoplay; fullscreen";
  iframe.allowFullscreen=true;
  playerBox.innerHTML="";
  playerBox.appendChild(iframe);
}

function playEpisode(){
  const iframe=document.createElement("iframe");
  iframe.src=VIDAPI.tv(current.id,current.season,current.episode);
  iframe.allow="autoplay; fullscreen";
  iframe.allowFullscreen=true;
  playerBox.innerHTML="";
  playerBox.appendChild(iframe);
}

function reloadPlayer(){
  current.type==="movie" ? playMovie() : playEpisode();
}

function closePlayer(){
  playerUI.style.display="none";
  playerBox.innerHTML="";
}

loadHome();
</script>

</body>
</html>
