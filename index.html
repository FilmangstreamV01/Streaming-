<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmangStream - Version Premium IntÃ©grale</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{ --red:#e50914; --dark:#141414; --text:#fff; --card-radius:8px; --transition:all 0.3s ease; }
        *{box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
        body{background:var(--dark); color:var(--text); min-height:100vh; padding-bottom:80px; overflow-x:hidden;}
        
        header{position:sticky; top:0; background:#111; padding:15px 20px; z-index:100; border-bottom:2px solid var(--red); display:flex; flex-direction:column; gap:10px;}
        .logo{font-size:1.8rem; font-weight:900; background:linear-gradient(135deg,var(--red) 0%,#ff0a16 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
        #search{width:100%; padding:12px 20px; border-radius:25px; border:none; background:#222; color:#fff; outline:none; transition: 0.3s;}
        #search:focus{box-shadow: 0 0 10px rgba(229, 9, 20, 0.5);}

        section{padding:20px 0 0 20px;}
        section h2{margin-bottom:15px; font-size:1.2rem; display:flex; align-items:center; gap:10px; color: #eee;}
        section h2::before{content:''; width:4px; height:20px; background:var(--red); border-radius:2px;}
        
        .row{display:flex; gap:15px; overflow-x:auto; padding-bottom:15px; scroll-behavior:smooth; scrollbar-width: none;}
        .row::-webkit-scrollbar{display: none;}

        .card{min-width:140px; width:140px; cursor:pointer; position:relative; transition:var(--transition); border-radius:var(--card-radius); overflow:hidden; background:#1a1a1a; flex-shrink:0;}
        .card:hover{transform:scale(1.05); z-index:10; box-shadow: 0 10px 20px rgba(0,0,0,0.5);}
        .card img{width:100%; height:210px; object-fit:cover; display:block;}
        .card p{text-align:center; padding:8px; font-size:0.8rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; color:#fff;}
        
        .play-overlay{position:absolute; top:0; left:0; width:100%; height:210px; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; opacity:0; transition:var(--transition);}
        .card:hover .play-overlay{opacity:1;}
        .play-overlay i{font-size:3rem; color:var(--red);}
        .badge{position:absolute; top:8px; right:8px; background:var(--red); color:#fff; padding:2px 6px; font-size:0.65rem; border-radius:4px; font-weight:bold; z-index:2;}

        /* LECTEUR PLEIN Ã‰CRAN UNIFIÃ‰ */
        #mainPlayer{display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:2000; background:#000;}
        #contentFrame{width:100%; height:100%; border:none;}
        #ytContainer{width:100%; height:100%; display:none;}
        .back-btn{position:absolute; top:20px; left:20px; z-index:2001; background:var(--red); border:none; color:white; padding:12px 25px; border-radius:30px; cursor:pointer; font-weight:bold; display:flex; align-items:center; gap:10px; box-shadow: 0 4px 20px rgba(0,0,0,0.8); transition: 0.2s;}
        .back-btn:active{transform: scale(0.9);}

        /* TOAST API */
        #apiToast{visibility:hidden; min-width:280px; background-color:#222; color:#fff; text-align:center; border-radius:8px; padding:16px; position:fixed; z-index:3000; left:50%; bottom:100px; transform:translateX(-50%); border:1px solid var(--red); font-weight: bold;}
        #apiToast.show{visibility:visible; animation:fadein 0.5s, fadeout 0.5s 2.5s;}

        nav{position:fixed; bottom:0; width:100%; background:#111; display:flex; justify-content:space-around; padding:12px 0; border-top:2px solid var(--red); z-index:1000;}
        nav div{text-align:center; color:#666; font-size:0.7rem; cursor:pointer;}
        nav div.active{color:var(--red);}
        nav i{display:block; font-size:1.4rem; margin-bottom:4px;}

        @keyframes fadein{from{bottom:0; opacity:0;} to{bottom:100px; opacity:1;}}
        @keyframes fadeout{from{bottom:100px; opacity:1;} to{bottom:0; opacity:0;}}
    </style>
</head>
<body>

<header id="siteHeader">
    <div class="logo">FILMANGSTREAM</div>
    <input id="search" placeholder="Films, SÃ©ries, Musique, Shorts...">
</header>

<div id="homeContent">
    <section>
        <h2>ðŸ“¡ TV DIRECT & PREMIUM</h2>
        <div class="row" id="tvDirect"></div>
    </section>
    
    <section>
        <h2>ðŸš€ Multi-Streaming</h2>
        <div class="row">
            <div class="card" onclick="openFull('https://www.netflix.com')"><img src="images/netflix.png" onerror="this.src='https://via.placeholder.com/140x210?text=Netflix'"><p>Netflix</p><span class="badge">VOD</span></div>
            <div class="card" onclick="openFull('https://www.crunchyroll.com')"><img src="images/crunchyroll.png" onerror="this.src='https://via.placeholder.com/140x210?text=Crunchyroll'"><p>Crunchyroll</p><span class="badge">ANIME</span></div>
            <div class="card" onclick="openFull('https://www.primevideo.com')"><img src="images/primevideo.png" onerror="this.src='https://via.placeholder.com/140x210?text=Prime'"><p>Prime Video</p><span class="badge">VOD</span></div>
            <div class="card" onclick="openFull('https://anime-sama.store/')"><img src="images/animesama.png" onerror="this.src='https://via.placeholder.com/140x210?text=AnimeSama'"><p>Anime Sama</p><span class="badge">FREE</span></div>
        </div>
    </section>

    <section><h2>ðŸŽ¬ Films Populaires (TMDB)</h2><div class="row" id="filmsRow"></div></section>
    <section><h2>ðŸ“º SÃ©ries Populaires (TMDB)</h2><div class="row" id="seriesRow"></div></section>
    <section><h2>ðŸ”¥ Anime & Mangas (Kitsu)</h2><div class="row" id="animeRow"></div></section>
    
    <section><h2>ðŸŽµ Musique Tendance</h2><div class="row" id="musicRow"></div></section>
    
    <section><h2>ðŸ“± Shorts Infini (YouTube)</h2><div class="row" id="shortsRow"></div></section>
</div>

<div id="mainPlayer">
    <button class="back-btn" onclick="closeFull()"><i class="fas fa-arrow-left"></i> RETOUR Ã€ L'ACCUEIL</button>
    <iframe id="contentFrame" allow="autoplay; encrypted-media; fullscreen" allowfullscreen></iframe>
    <div id="ytContainer"></div>
</div>

<div id="apiToast">Bascule vers la clÃ© API YouTube suivante...</div>

<nav id="siteNav">
    <div class="active"><i class="fa fa-home"></i>Accueil</div>
    <div><i class="fa fa-fire"></i>Tendance</div>
    <div><i class="fa fa-heart"></i>Favoris</div>
    <div><i class="fa fa-history"></i>Historique</div>
</nav>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
// CONFIGURATION DES 3 CLÃ‰S API
const YT_KEYS = [
    "AIzaSyD4Fd78deAlUd8H8kU4X3WfYVlW0-FmWmc", 
    "AIzaSyD5DEzxClq1pp88qrL80mm86H_e9slqHtY", 
    "AIzaSyBEos5Lzr0WbleEdtP_Gi7kMHcxaL9hhR0"
];
let currentKeyIdx = 0;
const TMDB_KEY = "1073e4d36ef71f912da093a5eb38f091";
let ytPlayer;

// Liste des chaÃ®nes TV issue du 2Ã¨me code
const TV_CHANNELS = [
    { name: "TF1" }, { name: "France 2" }, { name: "M6" }, 
    { name: "Canal+ Sport" }, { name: "Canal+ Family" }, { name: "Eurosport" },
    { name: "Nickelodeon" }, { name: "Disney Channel" }, { name: "SyFy" }, 
    { name: "Warner TV" }, { name: "J-One" }, { name: "Mangas" }
];

// Initialisation Lecteur YouTube
function onYouTubeIframeAPIReady() {
    ytPlayer = new YT.Player('ytContainer', {
        height: '100%', width: '100%',
        playerVars: { 'autoplay': 1, 'modestbranding': 1, 'rel': 0 }
    });
}

// FONCTION PLEIN Ã‰CRAN (InspirÃ©e du 2Ã¨me code)
function requestFullScreen(element) {
    if (element.requestFullscreen) { element.requestFullscreen(); }
    else if (element.webkitRequestFullscreen) { element.webkitRequestFullscreen(); }
    else if (element.mozRequestFullScreen) { element.mozRequestFullScreen(); }
    else if (element.msRequestFullscreen) { element.msRequestFullscreen(); }
}

// FONCTION D'OUVERTURE PLEIN Ã‰CRAN
function openFull(url, isYT = false, ytId = "") {
    document.getElementById('mainPlayer').style.display = 'block';
    document.body.style.overflow = 'hidden'; 
    const frame = document.getElementById('contentFrame');
    const ytDiv = document.getElementById('ytContainer');

    if (isYT) {
        frame.style.display = 'none';
        ytDiv.style.display = 'block';
        ytPlayer.loadVideoById(ytId);
    } else {
        ytDiv.style.display = 'none';
        frame.style.display = 'block';
        // Transformation URL Youtube si nÃ©cessaire
        let finalUrl = url;
        if(url.includes("youtube.com/watch?v=")) finalUrl = url.replace("watch?v=", "embed/") + "?autoplay=1";
        frame.src = finalUrl;
        
        // Auto-fullscreen aprÃ¨s un court dÃ©lai pour laisser l'iframe charger
        setTimeout(() => requestFullScreen(frame), 1000);
    }
}

function closeFull() {
    document.getElementById('mainPlayer').style.display = 'none';
    document.body.style.overflow = 'auto';
    document.getElementById('contentFrame').src = "";
    if(ytPlayer) ytPlayer.stopVideo();
    if (document.fullscreenElement) { document.exitFullscreen(); }
}

// CHARGEMENT YOUTUBE (MUSIQUE & SHORTS)
async function fetchYT(id, q, append=false) {
    const row = document.getElementById(id);
    const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&type=video&maxResults=10&key=${YT_KEYS[currentKeyIdx]}`;
    
    try {
        const res = await fetch(url);
        const data = await res.json();
        
        if(data.error && data.error.code === 403 && currentKeyIdx < YT_KEYS.length - 1) {
            currentKeyIdx++;
            document.getElementById("apiToast").className = "show";
            setTimeout(() => { document.getElementById("apiToast").className = ""; }, 3000);
            return fetchYT(id, q, append);
        }
        
        const html = data.items.map(v => `
            <div class="card" onclick="openFull('', true, '${v.id.videoId}')">
                <img src="${v.snippet.thumbnails.high.url}">
                <div class="play-overlay"><i class="fas fa-play"></i></div>
                <p>${v.snippet.title}</p>
            </div>`).join('');
        if(append) row.innerHTML += html; else row.innerHTML = html;
    } catch(e) {}
}

// CHARGEMENT TMDB (FILMS & SÃ‰RIES)
async function loadTMDB(id, type) {
    const row = document.getElementById(id);
    const url = `https://api.themoviedb.org/3/${type}/popular?api_key=${TMDB_KEY}&language=fr-FR`;
    try {
        const res = await fetch(url);
        const data = await res.json();
        row.innerHTML = data.results.slice(0,12).map(m => `
            <div class="card" onclick="openFull('https://www.themoviedb.org/${type}/${m.id}')">
                <img src="https://image.tmdb.org/t/p/w500${m.poster_path}">
                <div class="play-overlay"><i class="fas fa-eye"></i></div>
                <p>${m.title || m.name}</p>
            </div>`).join('');
    } catch(e) {}
}

// CHARGEMENT KITSU (MANGAS)
async function loadKitsu() {
    const row = document.getElementById('animeRow');
    const res = await fetch("https://kitsu.io/api/edge/anime?page[limit]=12&sort=-favoritesCount");
    const data = await res.json();
    row.innerHTML = data.data.map(a => `
        <div class="card" onclick="openFull('https://kitsu.io/anime/${a.id}')">
            <img src="${a.attributes.posterImage.medium}">
            <div class="play-overlay"><i class="fas fa-book-open"></i></div>
            <p>${a.attributes.canonicalTitle}</p>
        </div>`).join('');
}

// CHARGEMENT TV (InspirÃ© de ton 2Ã¨me code)
function loadTV() {
    const container = document.getElementById('tvDirect');
    container.innerHTML = TV_CHANNELS.map(ch => {
        const fileName = ch.name.replace(/\s+/g, '');
        return `
            <div class="card" onclick="openFull('https://vavoo.to')">
                <img src="images/${fileName}.png" onerror="this.src='https://via.placeholder.com/140x210?text=${ch.name}'">
                <div class="play-overlay"><i class="fas fa-tv"></i></div>
                <p>${ch.name}</p><span class="badge">LIVE</span>
            </div>`;
    }).join("");
}

// INFINITE SCROLL POUR LES SHORTS
document.getElementById('shortsRow').onscroll = function() {
    if(this.scrollLeft + this.clientWidth >= this.scrollWidth - 50) {
        fetchYT('shortsRow', 'Shorts tendance viral', true);
    }
};

// RECHERCHE UNIFIÃ‰E
document.getElementById('search').addEventListener('keypress', (e) => {
    if(e.key === 'Enter') {
        const q = e.target.value;
        fetchYT('musicRow', q + " music");
        fetchYT('shortsRow', q + " shorts");
    }
});

window.onload = () => {
    loadTV();
    loadTMDB('filmsRow', 'movie');
    loadTMDB('seriesRow', 'tv');
    loadKitsu();
    fetchYT('musicRow', 'Hits Musique 2026');
    fetchYT('shortsRow', 'Shorts viral tendance');
};
</script>
</body>
</html>
