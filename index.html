<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FilmangStream Pro - Premium</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --red: #e50914;
            --black: #0a0a0a;
            --gray: #1a1a1a;
            --text: #ffffff;
            --radius: 12px;
            --dm-blue: #0062ff;
            --glow-color: rgba(229, 9, 20, 0.5);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --transition-fast: 0.2s ease;
            --transition-slow: 0.4s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--black);
            background-image: radial-gradient(circle at 50% 0%, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 25%);
            color: var(--text);
            font-family: 'Montserrat', sans-serif;
            padding-top: 130px;
            overflow-x: hidden;
        }
        
        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--black); }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--red); }

        /* --- Header & Navigation --- */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            /* Glassmorphism Effect */
            background: rgba(10, 10, 10, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background var(--transition-fast);
        }

        .top-bar {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            gap: 15px;
        }

        .logo {
            font-size: 1.2rem;
            font-weight: 900;
            color: var(--red);
            text-transform: uppercase;
            cursor: pointer;
            text-shadow: 0 0 5px var(--glow-color);
        }

        .search-box {
            position: relative;
            flex-grow: 1;
            display: flex;
            align-items: center;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            color: #888;
        }

        #search {
            width: 100%;
            background: var(--gray);
            border: 1px solid transparent;
            padding: 10px 15px 10px 40px;
            border-radius: 20px;
            color: white;
            outline: none;
            transition: all var(--transition-slow);
        }
        #search:focus {
            border-color: var(--red);
            background: #222;
            box-shadow: 0 0 15px var(--glow-color);
        }

        nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 10px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .nav-item {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid #333;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            color: #aaa;
            transition: all var(--transition-fast);
        }
        .nav-item:hover {
            background: #222;
            color: white;
        }
        .nav-item.active {
            background: var(--red);
            color: white;
            border-color: var(--red);
            box-shadow: 0 0 10px var(--glow-color);
        }

        /* --- Hero Section --- */
        #heroSection {
            width: 100%;
            height: 420px; /* Increased height */
            position: relative;
            overflow: hidden;
            background: #111;
            border-radius: 0 0 var(--radius) var(--radius);
        }

        .hero-container {
            display: flex;
            transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1); /* Smoother transition */
            height: 100%;
        }

        .hero-item {
            min-width: 100%;
            height: 100%;
            position: relative;
        }
        .hero-item::after { /* Gradient overlay for text readability */
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70%;
            background: linear-gradient(to top, rgba(10,10,10,1) 0%, rgba(10,10,10,0) 100%);
        }

        .hero-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.8);
        }

        .hero-info {
            position: absolute;
            bottom: 40px;
            left: 25px;
            right: 25px;
            z-index: 10;
        }

        .hero-title {
            font-size: 2rem;
            font-weight: 900;
            text-shadow: 0 2px 10px var(--shadow-color);
        }
        .hero-description {
            font-size: 0.9rem;
            color: #ccc;
            margin-top: 5px;
            max-width: 60%;
        }

        /* --- Content Sections --- */
        section {
            padding: 30px 0 0 20px;
        }

        h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-left: 5px solid var(--red);
            padding-left: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .row {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 5px 5px 20px 5px; /* Added padding for glow effect */
            scrollbar-width: none;
            margin-left: -5px;
        }
        
        /* --- Card Styling --- */
        .card {
            min-width: 150px; /* Slightly larger cards */
            width: 150px;
            border-radius: var(--radius);
            overflow: hidden;
            background: #111;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
            /* Transitions for hover effect */
            transition: transform var(--transition-slow), box-shadow var(--transition-slow);
        }
        
        .card:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 10px 30px var(--shadow-color), 0 0 20px var(--glow-color);
            z-index: 10;
        }

        .card .img-container { /* New container for image and overlays */
            width: 100%;
            height: 220px;
            position: relative;
            background: #222;
        }
        
        .card .img-container::before { /* Gradient overlay for title */
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 50%;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            z-index: 2;
        }
        
        .card .img-container::after { /* Play icon on hover */
            content: '\f04b';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            color: white;
            background: rgba(0,0,0,0.5);
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            z-index: 3;
            opacity: 0;
            transition: opacity var(--transition-slow), transform var(--transition-slow);
        }
        
        .card:hover .img-container::after {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform var(--transition-slow);
        }
        .card:hover img {
            transform: scale(1.1);
        }

        .card-info {
            padding: 10px;
            font-size: 0.8rem;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #ddd;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 3;
            background: transparent; /* Info is now over the gradient */
        }
        
        .badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--red);
            color: white;
            font-size: 0.6rem;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 900;
            z-index: 5;
            text-shadow: 0 1px 3px var(--shadow-color);
        }
        .badge.live {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 var(--glow-color); }
            70% { box-shadow: 0 0 0 10px rgba(229, 9, 20, 0); }
            100% { box-shadow: 0 0 0 0 rgba(229, 9, 20, 0); }
        }

        /* --- Player & Shorts --- */
        #mainPlayer {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 2000;
        }

        #shortsFeed {
            height: 100dvh;
            width: 100vw;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            display: none;
            scrollbar-width: none;
        }

        .short-slide {
            height: 100dvh;
            width: 100vw;
            scroll-snap-align: start;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #000;
        }

        .short-slide iframe {
            height: 100%;
            width: 100%;
            max-width: 500px;
            border: none;
        }
        
        .btn-close {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2100;
            font-weight: bold;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background var(--transition-fast), transform var(--transition-fast);
        }
        .btn-close:hover {
            background: var(--red);
            transform: scale(1.1);
        }

        #ifr {
            width: 100vw;
            height: 100dvh;
            border: none;
            display: none;
        }
        
        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            body { padding-top: 120px; }
            .logo { font-size: 1rem; }
            .hero-title { font-size: 1.5rem; }
            .hero-description { display: none; }
            h2 { font-size: 1rem; }
            .card { min-width: 130px; width: 130px; }
            .card .img-container { height: 180px; }
            section { padding-left: 15px; }
            .top-bar, nav { padding-left: 15px; padding-right: 15px; }
        }

    </style>
</head>
<body>

<header>
    <div class="top-bar">
        <div class="logo" onclick="location.reload()">FILMANGSTREAM</div>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input id="search" type="text" placeholder="Rechercher...">
        </div>
    </div>
    <nav>
        <div class="nav-item active" onclick="setActive(this); window.scrollTo(0,0)">Accueil</div>
        <div class="nav-item" onclick="jump('shortsSection'); setActive(this)">Shorts</div>
        <div class="nav-item" onclick="jump('videoSection'); setActive(this)">Vidéos</div>
        <div class="nav-item" onclick="jump('filmSection'); setActive(this)">Films</div>
        <div class="nav-item" onclick="jump('seriesSection'); setActive(this)">Séries</div>
        <div class="nav-item" onclick="jump('animeSection'); setActive(this)">Animes</div>
        <div class="nav-item" onclick="jump('streamSection'); setActive(this)">Streaming</div>
        <div class="nav-item" onclick="jump('tvSection'); setActive(this)">TV</div>
    </nav>
</header>

<main id="main">
    <section id="heroSection">
        <div class="hero-container" id="heroRow">
            <!-- Hero items will be dynamically injected here by JS -->
        </div>
    </section>

    <section id="shortsSection"><h2><i class="fab fa-youtube" style="color:red"></i> YouTube Shorts</h2><div class="row" id="shortsRow"></div></section>
    <section id="dmShortsSection"><h2 style="border-left-color:var(--dm-blue)"><i class="fab fa-dailymotion" style="color:var(--dm-blue)"></i> Dailymotion Shorts</h2><div class="row" id="dmShortsRow"></div></section>
    <section id="videoSection"><h2><i class="fas fa-play-circle"></i> Vidéos YouTube</h2><div class="row" id="videoRow"></div></section>
    <section id="dmVideoSection"><h2 style="border-left-color:var(--dm-blue)"><i class="fas fa-video"></i> Vidéos Dailymotion</h2><div class="row" id="dmVideoRow"></div></section>

    <section id="filmSection"><h2><i class="fas fa-film"></i> Films Populaires</h2><div class="row" id="filmRow"></div></section>
    <section id="seriesSection"><h2><i class="fas fa-tv"></i> Séries TV</h2><div class="row" id="seriesRow"></div></section>
    <section id="animeSection"><h2><i class="fas fa-dragon"></i> Animes & Mangas</h2><div class="row" id="animeRow"></div></section>

    <section id="streamSection">
        <h2><i class="fas fa-layer-group"></i> Multi-Streaming</h2>
        <div class="row">
            <div class="card" onclick="window.open('https://www.netflix.com', '_blank')"><div class="img-container"><img src="images/netflix.png" onerror="this.src='https://via.placeholder.com/150x220/e50914/fff?text=Netflix'"></div><div class="card-info">Netflix</div></div>
            <div class="card" onclick="window.open('https://www.primevideo.com', '_blank')"><div class="img-container"><img src="images/primevideo.png" onerror="this.src='https://via.placeholder.com/150x220/00a8e1/fff?text=Prime+Video'"></div><div class="card-info">Prime Video</div></div>
            <div class="card" onclick="openInternal('https://www.disneyplus.com')"><div class="img-container"><img src="images/disneyplus.png" onerror="this.src='https://via.placeholder.com/150x220/0063be/fff?text=Disney+'"></div><div class="card-info">Disney Plus</div></div>
            <div class="card" onclick="openInternal('https://www.crunchyroll.com')"><div class="img-container"><img src="images/crunchyroll.png" onerror="this.src='https://via.placeholder.com/150x220/f47521/fff?text=Crunchyroll'"></div><div class="card-info">Crunchyroll</div></div>
            <div class="card" onclick="openInternal('https://anime-sama.store/')"><div class="img-container"><img src="images/animesama.png" onerror="this.src='https://via.placeholder.com/150x220/333/fff?text=AnimeSama'"></div><div class="card-info">Anime Sama</div></div>
        </div>
    </section>

    <section id="tvSection"><h2><i class="fas fa-broadcast-tower"></i> Direct TV Premium</h2><div class="row" id="tvRow"></div></section>
</main>

<div id="mainPlayer">
    <button class="btn-close" onclick="closePlayer()">✕</button>
    <iframe id="ifr" allowfullscreen allow="autoplay; fullscreen"></iframe>
    <div id="shortsFeed"></div>
</div>

<script>
// --- LE CODE JAVASCRIPT RESTE INCHANGÉ ---
// --- IL EST JUSTE MODIFIÉ POUR S'ADAPTER À LA NOUVELLE STRUCTURE HTML DES CARTES ---

const YT_KEYS = ["AIzaSyD4Fd78deAlUd8H8kU4X3WfYVlW0-FmWmc", "AIzaSyD5DEzxClq1pp88qrL80mm86H_e9slqHtY"];
let currentKeyIdx = 0, heroIdx = 0, shortsObserver;

window.onload = () => {
    loadTV(); loadHero(); loadTMDB('filmRow', 'movie'); loadTMDB('seriesRow', 'tv'); loadKitsu();
    refreshContent('film complet 2025');
    document.getElementById('search').addEventListener('keypress', (e) => { if(e.key === 'Enter') refreshContent(e.target.value); });
};

async function refreshContent(q) {
    fetchYT('videoRow', q, false);
    fetchYT('shortsRow', q + " #shorts", true);
    fetchDM('dmVideoRow', q, false);
    fetchDM('dmShortsRow', q + " shorts", true);
}

function openInternal(url) {
    const player = document.getElementById('mainPlayer');
    player.style.display = 'block';
    if (player.requestFullscreen) player.requestFullscreen().catch(err => console.log(err));
    else if (player.webkitRequestFullscreen) player.webkitRequestFullscreen().catch(err => console.log(err));
    const ifr = document.getElementById('ifr');
    ifr.style.display = 'block';
    ifr.src = url;
    document.getElementById('shortsFeed').style.display = 'none';
}

async function fetchYT(id, q, isShort) {
    try {
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&type=video&maxResults=12&key=${YT_KEYS[currentKeyIdx]}`;
        const r = await fetch(url);
        const d = await r.json();
        if(d.items) render(id, d.items.map(v => ({ id: v.id.videoId, t: v.snippet.title, img: v.snippet.thumbnails.high.url, source: 'yt' })), isShort);
        else if(d.error && currentKeyIdx < YT_KEYS.length - 1) { currentKeyIdx++; fetchYT(id, q, isShort); }
    } catch(e) {}
}

async function fetchDM(id, q, isShort) {
    try {
        const url = `https://api.dailymotion.com/videos?search=${encodeURIComponent(q)}&fields=id,title,thumbnail_480_url&limit=12`;
        const r = await fetch(url);
        const d = await r.json();
        if(d.list) render(id, d.list.map(v => ({ id: v.id, t: v.title, img: v.thumbnail_480_url, source: 'dm' })), isShort);
    } catch(e) {}
}

// MODIFIED RENDER FUNCTION to match new card structure
function render(id, items, isShort) {
    window[`list_${id}`] = items;
    document.getElementById(id).innerHTML = items.map((i, idx) => `
        <div class="card" onclick="openMedia('${id}', ${idx}, ${isShort})">
            <span class="badge" style="background:${i.source==='dm'?'var(--dm-blue)':'red'}">${i.source.toUpperCase()}</span>
            <div class="img-container"><img src="${i.img}"></div>
            <div class="card-info">${i.t}</div>
        </div>`).join('');
}

function openMedia(listId, idx, isShort) {
    const items = window[`list_${listId}`];
    openInternal(""); // Prepare fullscreen
    if(isShort) openShortsFeed(idx, items);
    else {
        const item = items[idx];
        const url = item.source === 'yt' ? `https://www.youtube.com/embed/${item.id}?autoplay=1` : `https://www.dailymotion.com/embed/video/${item.id}?autoplay=1`;
        document.getElementById('ifr').src = url;
    }
}

function openShortsFeed(idx, list) {
    const f = document.getElementById('shortsFeed');
    document.getElementById('ifr').style.display='none';
    f.style.display='block';
    f.innerHTML = list.map(s => `
        <div class="short-slide" data-id="${s.id}
