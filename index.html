<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>FilmangStream</title>

<style>
body{margin:0;background:#0b0b0b;color:#fff;font-family:system-ui}
header{padding:14px;font-size:22px;text-align:center;background:#e50914}

.section{padding:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}

.card{
  background:#161616;
  border-radius:14px;
  overflow:hidden;
  transition:.2s;
}
.card:active{transform:scale(.97)}
.card img{width:100%}
.card p{margin:6px;font-size:13px;text-align:center}

#playerUI{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  z-index:9999
}

#topbar{
  display:flex;
  gap:8px;
  padding:10px;
  background:linear-gradient(#000,#000a);
  align-items:center
}

select,button{
  background:#222;
  color:#fff;
  border:none;
  border-radius:10px;
  padding:8px 10px;
  font-size:14px
}

#playerBox{
  flex:1;
  position:relative
}
#playerBox iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:none
}

.badge{font-size:11px;color:#aaa}
</style>
</head>

<body>

<header>üé¨ FilmangStream</header>

<div class="section">
<h3>üé¨ Films</h3>
<div id="movies" class="grid"></div>
</div>

<div class="section">
<h3>üì∫ S√©ries</h3>
<div id="series" class="grid"></div>
</div>

<div class="section">
<h3>üç• Anime</h3>
<div id="anime" class="grid"></div>
</div>

<!-- PLAYER -->
<div id="playerUI">
  <div id="topbar">
    <button onclick="closePlayer()">‚¨Ö</button>

    <select id="season" style="display:none"></select>
    <select id="episode" style="display:none"></select>

    <button onclick="switchSource()">üîÅ Source</button>
  </div>

  <div id="playerBox"></div>
</div>

<script>
const API="https://api.themoviedb.org/3";
const KEY="1073e4d36ef71f912da093a5eb38f091";
const IMG="https://image.tmdb.org/t/p/w500";

let current={};
let sourceIndex=0;

const SOURCES={
  movie:[
    id=>`https://letsembed.cc/embed/movie/${id}`,
    id=>`https://vidsrc.to/embed/movie/${id}`,
    id=>`https://multiembed.mov/?video_id=${id}`
  ],
  tv:[
    (id,s,e)=>`https://letsembed.cc/embed/tv/${id}/${s}/${e}`,
    (id,s,e)=>`https://vidsrc.to/embed/tv/${id}/${s}/${e}`,
    (id,s,e)=>`https://multiembed.mov/?video_id=${id}&s=${s}&e=${e}`
  ]
};

async function get(u){return(await fetch(u)).json();}

function card(c,i,t){
  if(!i.poster_path)return;
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`<img src="${IMG+i.poster_path}"><p>${i.title||i.name}</p>`;
  d.onclick=()=>openContent(t,i.id);
  c.appendChild(d);
}

async function loadHome(){
  (await get(`${API}/movie/popular?api_key=${KEY}&language=fr`))
    .results.forEach(x=>card(movies,x,"movie"));

  (await get(`${API}/tv/popular?api_key=${KEY}&language=fr`))
    .results.forEach(x=>card(series,x,"tv"));

  (await get(`${API}/discover/tv?api_key=${KEY}&with_genres=16&language=fr`))
    .results.forEach(x=>card(anime,x,"tv"));
}

async function openContent(type,id){
  playerUI.style.display="flex";
  playerBox.innerHTML="";
  season.style.display="none";
  episode.style.display="none";
  sourceIndex=0;

  current={type,id};

  if(type==="movie"){
    play();
  }else{
    const tv=await get(`${API}/tv/${id}?api_key=${KEY}&language=fr`);
    season.innerHTML="<option>Saison</option>";
    tv.seasons.forEach(s=>{
      if(s.season_number>0)
        season.innerHTML+=`<option value="${s.season_number}">Saison ${s.season_number}</option>`;
    });
    season.style.display="block";
  }
}

season.onchange=async()=>{
  current.season=season.value;
  const e=await get(`${API}/tv/${current.id}/season/${current.season}?api_key=${KEY}&language=fr`);
  episode.innerHTML="<option>√âpisode</option>";
  e.episodes.forEach(ep=>{
    episode.innerHTML+=`<option value="${ep.episode_number}">√âpisode ${ep.episode_number}</option>`;
  });
  episode.style.display="block";
}

episode.onchange=()=>{
  current.episode=episode.value;
  play();
}

function play(){
  const iframe=document.createElement("iframe");
  iframe.allow="autoplay; fullscreen";
  iframe.allowFullscreen=true;

  const src=current.type==="movie"
    ? SOURCES.movie[sourceIndex](current.id)
    : SOURCES.tv[sourceIndex](current.id,current.season,current.episode);

  iframe.src=src;
  playerBox.innerHTML="";
  playerBox.appendChild(iframe);
}

function switchSource(){
  sourceIndex++;
  if(current.type==="movie" && sourceIndex>=SOURCES.movie.length) sourceIndex=0;
  if(current.type==="tv" && sourceIndex>=SOURCES.tv.length) sourceIndex=0;
  play();
}

function closePlayer(){
  playerUI.style.display="none";
  playerBox.innerHTML="";
}

loadHome();
</script>
</body>
</html>
